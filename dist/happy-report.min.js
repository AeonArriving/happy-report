"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function HappyPerformance(e,o){try{var t=function(){setTimeout(function(){f.isPage&&a(),f.isResource&&n(),ERRORLIST&&ERRORLIST.length&&(l.errorList=l.errorList.concat(ERRORLIST));var e={time:(new Date).getTime(),page:l.page,preUrl:l.preUrl,appVersion:l.appVersion,errorList:l.errorList,performance:l.performance,resourceList:l.resourceList,OTHERDATA:OTHERDATA,actionList:l.actionList,type:"resource"};o&&o(e),!o&&window.fetch&&fetch(f.domain,{method:"POST",type:"report-data",body:JSON.stringify(e)})},f.outtime)},i=function(){l.haveAjax&&l.haveFetch&&y&&v&&w?t():l.haveAjax&&!l.haveFetch&&y&&v?t():!l.haveAjax&&l.haveFetch&&y&&w?t():l.haveAjax||l.haveFetch||!y||t()},a=function(){if(window.performance){var e=performance.timing;l.performance={dnst:e.domainLookupEnd-e.domainLookupStart||0,tcpt:e.connectEnd-e.connectStart||0,wit:e.responseStart-e.navigationStart||0,domt:e.domContentLoadedEventEnd-e.navigationStart||0,lodt:e.loadEventEnd-e.navigationStart||0,radt:e.fetchStart-e.navigationStart||0,rdit:e.redirectEnd-e.redirectStart||0,uodt:e.unloadEventEnd-e.unloadEventStart||0,reqt:e.responseEnd-e.requestStart||0,andt:e.domComplete-e.domInteractive||0}}},n=function(){if(!window.performance&&!window.performance.getEntries)return!1;var e=performance.getEntriesByType("resource"),a=[];if(!e&&!e.length)return a;e.forEach(function(e){var t={name:e.name,method:"GET",type:e.initiatorType,duration:e.duration.toFixed(2)||0,decodedBodySize:e.decodedBodySize||0,nextHopProtocol:e.nextHopProtocol};if(l.ajaxMsg&&l.ajaxMsg.length)for(var r=0,o=l.ajaxMsg.length;r<o;r++)l.ajaxMsg[r].url===e.name&&(t.method=l.ajaxMsg[r].method||"GET",t.type=l.ajaxMsg[r].type||t.type);a.push(t)}),l.resourceList=a},s=function(e){var t={method:"GET",type:"fetchrequest"},r=Array.prototype.slice.apply(e);if(!r||!r.length)return t;try{1===r.length?"string"==typeof r[0]?t.url=r[0]:"object"===_typeof(r[0])&&(t.url=r[0].url,t.method=r[0].method):(t.url=r[0],t.method=r[1].method,t.type=r[1].type)}catch(e){}return t},r=function(e,t){var r=Object.assign({},m);r.time=(new Date).getTime(),r.resource="ajax",r.msg=e.statusText||"ajax request error",r.method=e.method,r.data={resourceUrl:e.responseURL,text:e.statusText,status:e.status},l.errorList.push(r)},c=function(e){l.fetchNum+=1,l.fetLength===l.fetchNum&&(l.fetchNum=l.fetLength=0,w=(new Date).getTime()-g,i())},u=function(e){l.loadNum+=1,l.loadNum===l.ajaxLength&&(l.ajaxLength=l.loadNum=0,v=(new Date).getTime()-g,i())},h=function(e){(window.performance||window.performance.clearResourceTimings)&&(l.haveAjax&&l.haveFetch&&0==l.ajaxLength&&0==l.fetLength?d():!l.haveAjax&&l.haveFetch&&0==l.fetLength?d():l.haveAjax&&!l.haveFetch&&0==l.ajaxLength&&d())},d=function(){performance.clearResourceTimings(),l.performance={},l.errorList=[],l.preUrl="",l.resourceList="",l.page=location.href,ERRORLIST=[],OTHERDATA={}},p=function(e){for(var t=document.getElementsByTagName("*"),r=[];e&&1==e.nodeType;e=e.parentNode){if(e.hasAttribute("id")){for(var o=0,a=0;a<t.length&&(t[a].hasAttribute("id")&&t[a].id==e.id&&o++,!(1<o));a++);return 1==o&&(r.unshift('//*[@id="'+e.getAttribute("id")+'"]'),r.join("/"))}for(var n=1,i=e.previousSibling;i;i=i.previousSibling)i.localName==e.localName&&n++;1==n?e.nextElementSibling?e.nextElementSibling.localName!=e.localName?r.unshift(e.localName.toLowerCase()):r.unshift(e.localName.toLowerCase()+"["+n+"]"):r.unshift(e.localName.toLowerCase()):r.unshift(e.localName.toLowerCase()+"["+n+"]")}return r.length?"/"+r.join("/"):null},f={domain:"http://rap2api.taobao.org/app/mock/7042//example/1520581163614",outtime:1e3,filterUrl:["http://localhost:35729/livereload.js?snipver=1"],isPage:!0,isResource:!0,isError:!0};f=Object.assign(f,e);var l={resourceList:[],performance:{},errorList:[],fetchNum:0,loadNum:0,ajaxLength:0,fetLength:0,ajaxMsg:[],goingType:"",haveAjax:!1,haveFetch:!1,preUrl:document.referrer&&document.referrer!==location.href?document.referrer:"",appVersion:navigator.appVersion,page:location.href,actionList:[]},m={time:"",resource:"js",msg:"",data:{}},g=(new Date).getTime(),y=0,v=0,w=0;return document.addEventListener("click",function(e){var t,r=p(e.target);l.actionList.push(r),t=r,setTimeout(function(){f.isPage&&a(),f.isResource&&n();var e={time:(new Date).getTime(),page:l.page,preUrl:l.preUrl,appVersion:l.appVersion,OTHERDATA:OTHERDATA,xpath:t,type:"action"};o&&o(e),!o&&window.fetch&&fetch(f.domain,{method:"POST",type:"report-action-data",body:JSON.stringify(e)})},0)}),f.isError&&(window.addEventListener("error",function(e){var t=Object.assign({},m);t.time=(new Date).getTime(),t.resource="resource",t.msg=e.target.localName+" is load error",t.method="GET",t.data={target:e.target.localName,type:e.type,resourceUrl:e.target.currentSrc},e.target!=window&&l.errorList.push(t)},!0),window.onerror=function(e,t,r,o,a){var n=Object.assign({},m);setTimeout(function(){o=o||window.event&&window.event.errorCharacter||0,n.msg=a&&a.stack?a.stack.toString():e,n.method="GET",n.data={resourceUrl:t,line:r,col:o},n.time=(new Date).getTime(),l.errorList.push(n),i()},0)}),addEventListener("load",function(){y=(new Date).getTime()-g,i()},!1),(f.isResource||f.isError)&&function(){if(window.fetch){var e=fetch;window.fetch=function(){var r=s(arguments);return"report-action-data"===r.type?e.apply(this,arguments):("report-data"!==r.type&&(h(),l.ajaxMsg.push(r),l.fetLength=l.fetLength+1,l.haveFetch=!0),e.apply(this,arguments).then(function(e){if("report-data"!==r.type)return c("success"),e}).catch(function(e){if("report-data"!==r.type){c("error");var t=Object.assign({},m);return t.time=(new Date).getTime(),t.resource="fetch",t.msg="fetch request error",t.method=r.method,t.data={resourceUrl:r.url,text:e.stack||e,status:0},l.errorList.push(t),e}}))}}}(),(f.isResource||f.isError)&&function(a){function r(e){return function(){return this.hasOwnProperty(e+"_")?this[e+"_"]:this.xhr[e]}}function o(o){return function(e){var t=this.xhr,r=this;0==o.indexOf("on")?a[o]?t[o]=function(){a[o](r)||e.apply(t,arguments)}:t[o]=e:this[o+"_"]=e}}function n(t){return function(){var e=[].slice.call(arguments);if(!a[t]||!a[t].call(this,e,this.xhr))return this.xhr[t].apply(this.xhr,e)}}window._ahrealxhr=window._ahrealxhr||XMLHttpRequest,XMLHttpRequest=function(){for(var e in this.xhr=new window._ahrealxhr,this.xhr){var t="";try{t=_typeof(this.xhr[e])}catch(e){}"function"===t?this[e]=n(e):Object.defineProperty(this,e,{get:r(e),set:o(e)})}},window._ahrealxhr}({onreadystatechange:function(e){4===e.readyState&&setTimeout(function(){"load"!==l.goingType&&(l.goingType="readychange",u(),(e.status<200||300<e.status)&&(e.method=e.args.method,r(e)))},600)},onerror:function(e){u(),e.args&&(e.method=e.args.method,e.responseURL=e.args.url,e.statusText="ajax request error"),r(e)},onload:function(e){if(4===e.readyState){if("readychange"===l.goingType)return;l.goingType="load",u(),(e.status<200||300<e.status)&&(e.method=e.args.method,r(e))}},open:function(t,e){if(f.filterUrl&&f.filterUrl.length){var r=!1;if(f.filterUrl.forEach(function(e){-1!=t[1].indexOf(e)&&(r=!0)}),r)return}var o={url:t[1],method:t[0]||"GET",type:"xmlhttprequest"};this.args=o,h(),l.ajaxMsg.push(o),l.ajaxLength=l.ajaxLength+1,l.haveAjax=!0}}),{getXpathToElem:function(e){try{return(new XPathEvaluator).evaluate(e,document.documentElement,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue||""}catch(e){return""}},getXPath:p}}catch(e){}}"function"==typeof require&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=HappyPerformance:window.HappyPerformance=HappyPerformance,window.ERRORLIST=[],window.OTHERDATA={},HappyPerformance.addError=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e={method:"GET",msg:e.msg,n:"js",data:{col:e.col,line:e.line,resourceUrl:e.resourceUrl}},ERRORLIST.push(e)},HappyPerformance.otherData=function(e){e&&e(OTHERDATA)};