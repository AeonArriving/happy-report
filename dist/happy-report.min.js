"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function HappyPerformance(e,o){try{var i=function(){var e=0;return"number"==typeof window.pageYOffset?e=window.pageYOffset:document.body&&(document.body.scrollLeft||document.body.scrollTop)?e=document.body.scrollTop:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(e=document.documentElement.scrollTop),e},a=function(){var e=sessionStorage.getItem("ps_markUser")||"",t={markUser:e,isFristIn:!1};return e||(e=function(e){e=e||10;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz123456789",r=t.length,n="",o=0;o<e;o++)n+=t.charAt(Math.floor(Math.random()*r));return n+(new Date).getTime()}(),sessionStorage.setItem("ps_markUser",e),t.markUser=e,t.isFristIn=!0),t},t=function(){setTimeout(function(){var e=a();T.isPage&&m(),T.isResource&&h(),ERRORLIST&&ERRORLIST.length&&(E.errorList=E.errorList.concat(ERRORLIST));var t={markUser:e.markUser,isFristIn:e.isFristIn,time:(new Date).getTime(),page:E.page,preUrl:E.preUrl,appVersion:E.appVersion,errorList:E.errorList,performance:E.performance,resourceList:E.resourceList,otherData:OTHERDATA,actionList:E.actionList,type:"resource"};o&&o(t),!o&&window.fetch&&fetch(T.domain,{method:"POST",type:"report-data",body:JSON.stringify(t)}).then(function(){y(),v()})},T.outtime)},s=function(r,n){setTimeout(function(){var e=a();T.isPage&&m(),T.isResource&&h();var t={markUser:e.markUser,isFristIn:e.isFristIn,time:(new Date).getTime(),appVersion:E.appVersion,otherData:OTHERDATA,event:{page:E.page,moduleId:r,params:{preUrl:E.preUrl}},type:n?"scroll-action":"leave-action"};o&&o(t),!o&&window.fetch&&fetch(T.domain,{method:"POST",type:"report-leave-data",body:JSON.stringify(t)})},0)},c=function(e,t){return(e.target||e.srcElement).getAttribute(t)||""},u=function(e){return(e.target||e.srcElement).nodeName.toLocaleLowerCase()||""},d=function(e){var t=e.target||e.srcElement,r=t.nodeName.toLocaleLowerCase()||"";return"body"!==r&&"html"!==r&&""!==r?t.innerText||t.value:n(t.innerText||t.value)},n=function(e){var t=0<arguments.length&&void 0!==e?e:"";return 30<t.length&&(t=t.slice(0,15)+"..."+t.slice(t.length-15)),t},l=function(){E.haveAjax&&E.haveFetch&&S&&j&&R?t():E.haveAjax&&!E.haveFetch&&S&&j?t():!E.haveAjax&&E.haveFetch&&S&&R?t():E.haveAjax||E.haveFetch||!S||t()},m=function(){if(window.performance){var e=performance.timing;E.performance={dnst:e.domainLookupEnd-e.domainLookupStart||0,tcpt:e.connectEnd-e.connectStart||0,wit:e.responseStart-e.navigationStart||0,domt:e.domContentLoadedEventEnd-e.navigationStart||0,lodt:e.loadEventEnd-e.navigationStart||0,radt:e.fetchStart-e.navigationStart||0,rdit:e.redirectEnd-e.redirectStart||0,uodt:e.unloadEventEnd-e.unloadEventStart||0,reqt:e.responseEnd-e.requestStart||0,andt:e.domComplete-e.domInteractive||0}}},h=function(){if(!window.performance&&!window.performance.getEntries)return!1;var e=performance.getEntriesByType("resource"),o=[];if(!e&&!e.length)return o;e.forEach(function(e){var t={name:e.name,method:"GET",type:e.initiatorType,duration:e.duration.toFixed(2)||0,decodedBodySize:e.decodedBodySize||0,nextHopProtocol:e.nextHopProtocol};if(E.ajaxMsg&&E.ajaxMsg.length)for(var r=0,n=E.ajaxMsg.length;r<n;r++)E.ajaxMsg[r].url===e.name&&(t.method=E.ajaxMsg[r].method||"GET",t.type=E.ajaxMsg[r].type||t.type);o.push(t)}),E.resourceList=o},p=function(e){var t={method:"GET",type:"fetchrequest"},r=Array.prototype.slice.apply(e);if(!r||!r.length)return t;try{1===r.length?"string"==typeof r[0]?t.url=r[0]:"object"===_typeof(r[0])&&(t.url=r[0].url,t.method=r[0].method):(t.url=r[0],t.method=r[1].method,t.type=r[1].type)}catch(e){}return t},r=function(e){var t=Object.assign({},L);t.time=(new Date).getTime(),t.resource="ajax",t.msg=e.statusText||"ajax request error",t.method=e.method,t.data={resourceUrl:e.responseURL,text:e.statusText,status:e.status},E.errorList.push(t)},f=function(){E.fetchNum+=1,E.fetLength===E.fetchNum&&(E.fetchNum=E.fetLength=0,R=(new Date).getTime()-x,l())},g=function(){E.loadNum+=1,E.loadNum===E.ajaxLength&&(E.ajaxLength=E.loadNum=0,j=(new Date).getTime()-x,l())},v=function(){(window.performance||window.performance.clearResourceTimings)&&(E.haveAjax&&E.haveFetch&&0==E.ajaxLength&&0==E.fetLength?y():!E.haveAjax&&E.haveFetch&&0==E.fetLength?y():E.haveAjax&&!E.haveFetch&&0==E.ajaxLength&&y())},y=function(){performance.clearResourceTimings(),E.performance={},E.errorList=[],E.preUrl="",E.resourceList="",E.page=location.href,E.actionList=[],ERRORLIST=[]},w=function(e){for(var t=document.getElementsByTagName("*"),r=[];e&&1==e.nodeType;e=e.parentNode){if(e.hasAttribute("id")){for(var n=0,o=0;o<t.length&&(t[o].hasAttribute("id")&&t[o].id==e.id&&n++,!(1<n));o++);return 1==n&&(r.unshift('//*[@id="'+e.getAttribute("id")+'"]'),r.join("/"))}for(var a=1,i=e.previousSibling;i;i=i.previousSibling)i.localName==e.localName&&a++;1==a?e.nextElementSibling?e.nextElementSibling.localName!=e.localName?r.unshift(e.localName.toLowerCase()):r.unshift(e.localName.toLowerCase()+"["+a+"]"):r.unshift(e.localName.toLowerCase()):r.unshift(e.localName.toLowerCase()+"["+a+"]")}return r.length?"/"+r.join("/"):null},T={domain:"",outtime:1e3,filterUrl:["http://localhost:35729/livereload.js?snipver=1"],isPage:!0,isResource:!0,isError:!0};T=Object.assign(T,e);var E={resourceList:[],performance:{},errorList:[],fetchNum:0,loadNum:0,ajaxLength:0,fetLength:0,ajaxMsg:[],goingType:"",haveAjax:!1,haveFetch:!1,preUrl:document.referrer&&document.referrer!==location.href?document.referrer:"",appVersion:navigator.appVersion,page:location.href,actionList:[]},L={time:"",resource:"js",msg:"",data:{}},x=(new Date).getTime(),S=0,j=0,R=0;T.isError&&(window.addEventListener("error",function(e){var t=Object.assign({},L);t.time=(new Date).getTime(),t.resource="resource",t.msg=e.target.localName+" is load error",t.method="GET",t.data={target:e.target.localName,type:e.type,resourceUrl:e.target.currentSrc},e.target!=window&&E.errorList.push(t)},!0),window.onerror=function(e,t,r,n,o){var a=Object.assign({},L);setTimeout(function(){n=n||window.event&&window.event.errorCharacter||0,a.msg=o&&o.stack?o.stack.toString():e,a.method="GET",a.data={resourceUrl:t,line:r,col:n},a.time=(new Date).getTime(),E.errorList.push(a),l()},0)}),document.addEventListener("click",function(e){var r,n,t=w(e.target);E.actionList.push(t),r=t,n=e,setTimeout(function(){var e=a();T.isPage&&m(),T.isResource&&h();var t={markUser:e.markUser,isFristIn:e.isFristIn,time:(new Date).getTime(),appVersion:E.appVersion,otherData:OTHERDATA,event:{page:E.page,xpath:r,moduleId:c(n,"data-module-id"),params:{title:d(n),preUrl:E.preUrl,itemType:u(n)}},type:"action"};o&&o(t),!o&&window.fetch&&fetch(T.domain,{method:"POST",type:"report-action-data",body:JSON.stringify(t)})},0)},!1),window.addEventListener("load",function(){S=(new Date).getTime()-x,l()},!1),window.addEventListener("beforeunload",function(e){var t=sessionStorage.getItem("in_view_port_element_list").split(",");s(t[t.length-1]),sessionStorage.removeItem("in_view_port_element_list")}),sessionStorage.setItem("in_view_port_element_list",[]);var b=sessionStorage.getItem("in_view_port_element_list")||[];return window.addEventListener("scroll",(D=function(e){var r,n,o,a,t=document.querySelectorAll("[data-module-id]");Array.from(t).map(function(e,t){if(0<=(n=e.getBoundingClientRect()).top&&0<=n.left&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)){var r=e.getAttribute("data-module-id");b.push(r)}var n}),sessionStorage.setItem("in_view_port_element_list",b),r=document.body.clientHeight,n=i()+window.innerHeight,o=document.querySelectorAll("[data-module-id]"),(a=Array.from(o)).map(function(e,t){(0<o.length?n<1*a[t].offsetTop:n<1*r)||s(a[t].getAttribute("data-module-id"),!0)})},N=500,I=Date.now(),function(){var e=arguments,t=Date.now();N<=t-I&&(D.apply(this,e),I=Date.now())})),(T.isResource||T.isError)&&function(){if(window.fetch){var e=fetch;window.fetch=function(){var r=p(arguments);return"report-action-data"===r.type||"report-leave-data"===r.type?e.apply(this,arguments):("report-data"!==r.type&&(v(),E.ajaxMsg.push(r),E.fetLength=E.fetLength+1,E.haveFetch=!0),e.apply(this,arguments).then(function(e){if("report-data"!==r.type)return f("success"),e}).catch(function(e){if("report-data"!==r.type){f("error");var t=Object.assign({},L);return t.time=(new Date).getTime(),t.resource="fetch",t.msg="fetch request error",t.method=r.method,t.data={resourceUrl:r.url,text:e.stack||e,status:0},E.errorList.push(t),e}}))}}}(),(T.isResource||T.isError)&&(U={onreadystatechange:function(e){4===e.readyState&&setTimeout(function(){"load"!==E.goingType&&(E.goingType="readychange",g(),(e.status<200||300<e.status)&&(e.method=e.args.method,r(e)))},600)},onerror:function(e){g(),e.args&&(e.method=e.args.method,e.responseURL=e.args.url,e.statusText="ajax request error"),r(e)},onload:function(e){if(4===e.readyState){if("readychange"===E.goingType)return;E.goingType="load",g(),(e.status<200||300<e.status)&&(e.method=e.args.method,r(e))}},open:function(t){if(T.filterUrl&&T.filterUrl.length){var r=!1;if(T.filterUrl.forEach(function(e){-1!=t[1].indexOf(e)&&(r=!0)}),r)return}var e={url:t[1],method:t[0]||"GET",type:"xmlhttprequest"};this.args=e,v(),E.ajaxMsg.push(e),E.ajaxLength=E.ajaxLength+1,E.haveAjax=!0}},window._ahrealxhr=window._ahrealxhr||XMLHttpRequest,XMLHttpRequest=function(){for(var e in this.xhr=new window._ahrealxhr,this.xhr){var t="";try{t=_typeof(this.xhr[e])}catch(e){}"function"===t?this[e]=O(e):Object.defineProperty(this,e,{get:_(e),set:A(e)})}},window._ahrealxhr),{getXpathToElem:function(e){try{return(new XPathEvaluator).evaluate(e,document.documentElement,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue||""}catch(e){return""}},getXPath:w}}catch(e){}function _(e){return function(){return this.hasOwnProperty(e+"_")?this[e+"_"]:this.xhr[e]}}function A(n){return function(e){var t=this.xhr,r=this;0==n.indexOf("on")?U[n]?t[n]=function(){U[n](r)||e.apply(t,arguments)}:t[n]=e:this[n+"_"]=e}}function O(t){return function(){var e=[].slice.call(arguments);if(!U[t]||!U[t].call(this,e,this.xhr))return this.xhr[t].apply(this.xhr,e)}}var U,D,N,I}"function"==typeof require&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=HappyPerformance:window.HappyPerformance=HappyPerformance,window.ERRORLIST=[],window.OTHERDATA={},HappyPerformance.addError=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e={method:"GET",msg:e.msg,n:"js",data:{col:e.col,line:e.line,resourceUrl:e.resourceUrl}},ERRORLIST.push(e)},HappyPerformance.otherData=function(e){e&&e(OTHERDATA)};